<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>flappy bird</title>
<style>
    body {
        margin: 0;
        background: #111;
        overflow: hidden;
    }
    canvas {
        display: block;
        margin: auto;
        background: black;
    }
</style>
</head>
<body>

<canvas id="game"></canvas>

<script>
/* ============================================================
   CONFIG
   ============================================================ */
let w=20; let h=20;
const WINDOW_WIDTH = 40*w;
const WINDOW_HEIGHT = 30*h;

/* ============================================================
   GLOBALS
   ============================================================ */
const canvas = document.getElementById("game");
canvas.width = WINDOW_WIDTH;
canvas.height = WINDOW_HEIGHT;

const ctx = canvas.getContext("2d");

let running = true;

/* ============================================================
   INPUT
   ============================================================ */
const keys = {};

window.addEventListener("keydown", (e) => {
    keys[e.key] = true;
});

window.addEventListener("keyup", (e) => {
    keys[e.key] = false;
});
canvas.addEventListener("touchstart",(e)=>{py=py-h*4;e.preventDefault()})
/* ============================================================
   GAME STATE
   ============================================================ */
let px = 4*w;  // position in pixels, using scale
let py = 10*h; // position in pixels, using scale

// Initialize pipes with scaled positions and sizes
let maxh=20*h; let minh=15*h;
let pipe1x=20*w; 
let pipe1y1=20*h; 
let pipe1y2=pipe1y1 - 10*h; // subtract 10h for gap

let pipe2x=25*w; 
let pipe2y1=22*h; 
let pipe2y2=pipe2y1 - 10*h;

let pipe3x=30*w; 
let pipe3y1=20*h; 
let pipe3y2=pipe3y1 - 10*h;

let pipe4x=35*w; 
let pipe4y1=22*h; 
let pipe4y2=pipe4y1 - 10*h;

let score=0;

function pipes() {
    ctx.fillStyle="#00ff00";

    // Draw pipes with scaled positions and heights
    ctx.fillRect(pipe1x, pipe1y1, 2*w, (0 - pipe1y1) * (-1));
    ctx.fillRect(pipe1x, pipe1y2, 2*w, -(WINDOW_HEIGHT - (WINDOW_HEIGHT - pipe1y2)));

    ctx.fillRect(pipe2x, pipe2y1, 2*w, (0 - pipe2y1) * (-1));
    ctx.fillRect(pipe2x, pipe2y2, 2*w, -(WINDOW_HEIGHT - (WINDOW_HEIGHT - pipe2y2)));

    ctx.fillRect(pipe3x, pipe3y1, 2*w, (0 - pipe3y1) * (-1));
    ctx.fillRect(pipe3x, pipe3y2, 2*w, -(WINDOW_HEIGHT - (WINDOW_HEIGHT - pipe3y2)));

    ctx.fillRect(pipe4x, pipe4y1, 2*w, (0 - pipe4y1) * (-1));
    ctx.fillRect(pipe4x, pipe4y2, 2*w, -(WINDOW_HEIGHT - (WINDOW_HEIGHT - pipe4y2)));
}

/* ============================================================
   MAIN LOOP
   ============================================================ */
function game_loop() {

    if (!running) return;

    /* ===== UPDATE ===== */
    if(keys[" "]) { py -= h*4; }

    py += h; // gravity

    // Prevent py from going below 0 (top of screen)
    if(py < 0) py=0;

    // Collision detection (with pipes)
    if(
        ((py > pipe1y1 || py < pipe1y2) && (px===pipe1x || px===pipe1x+2*w)) ||
        ((py > pipe2y1 || py < pipe2y2) && (px===pipe2x || px===pipe2x+2*w)) ||
        ((py > pipe3y1 || py < pipe3y2) && (px===pipe3x || px===pipe3x+2*w)) ||
        ((py > pipe4y1 || py < pipe4y2) && (px===pipe4x || px===pipe4x+2*w))
    ) {
        // Reset pipes
        pipe1x=20*w; 
        pipe1y1=20*h; 
        pipe1y2=pipe1y1 - 10*h;

        pipe2x=25*w; 
        pipe2y1=22*h; 
        pipe2y2=pipe2y1 - 10*h;

        pipe3x=30*w; 
        pipe3y1=20*h; 
        pipe3y2=pipe3y1 - 10*h;

        pipe4x=35*w; 
        pipe4y1=22*h; 
        pipe4y2=pipe4y1 - 10*h;

        score=0;
    }

    // Move pipes left
    pipe1x -= 2*w;
    pipe2x -= 2*w;
    pipe3x -= 2*w;
    pipe4x -= 2*w;

    // Check if pipes have gone off screen and reset
    if(pipe1x <= 0) {
        score++;
        pipe1x= (Math.floor(Math.random()*3)+1)*2*w + 20*w; // position ahead
        let f= Math.floor(Math.random()*(maxh - minh +1)) + minh;
        pipe1y1=f;
        pipe1y2=pipe1y1 - 10*h;
    }
    if(pipe2x <= 0) {
        score++;
        pipe2x= (Math.floor(Math.random()*3)+1)*2*w + 20*w;
        let f= Math.floor(Math.random()*(maxh - minh +1)) + minh;
        pipe2y1=f;
        pipe2y2=pipe2y1 - 10*h;
    }
    if(pipe3x <= 0) {
        score++;
        pipe3x= (Math.floor(Math.random()*3)+1)*2*w + 20*w;
        let f= Math.floor(Math.random()*(maxh - minh +1)) + minh;
        pipe3y1=f;
        pipe3y2=pipe3y1 - 10*h;
    }
    if(pipe4x <= 0) {
        score++;
        pipe4x= (Math.floor(Math.random()*3)+1)*2*w + 20*w;
        let f= Math.floor(Math.random()*(maxh - minh +1)) + minh;
        pipe4y1=f;
        pipe4y2=pipe4y1 - 10*h;
    }

    /* ===== RENDER ===== */
    ctx.fillStyle="#202020";
    ctx.fillRect(0, 0, WINDOW_WIDTH, WINDOW_HEIGHT);
    ctx.fillStyle="#ffff00"; // bird color
    ctx.fillRect(px, py, w, h); // bird

    pipes();

    ctx.fillStyle="#ff0000";
    ctx.font = "10px Arial";
    ctx.fillText("score:" + score, 0, 10);

    setTimeout(() => {
        requestAnimationFrame(game_loop);
    }, 100);
}

game_loop();

</script>
</body>
</html>

